#信号#

##信号概念##

每个信号都有一个名字，都以3个字符SIG开头，如：    
* SIGABRT是夭折信号，当进程调用abort函数时产生这种信号   
* SIGALRM是闹钟信号，有alarm函数设置的定时器超时后会产生此信号   

在头文件`<signal.h>`中，信号名都被定义为正整数常量。   
不存在编号为0的信号，即空信号。   

信号的处理：   
1. 忽略此信号，SIGKILL和SIGSTOP两种信号不能被忽略   
2. 捕捉信号，上面两个信号不能被捕捉   
3. 执行系统默认操作，对大多数信号的系统默认动作是终止该进程   

##函数signal##

```C
#include<signal.h>
void (*signal(int signo , void (*func)(int)))(int);
//若成功，返回以前的信号处理配置，否则返回SIG_ERR
```
signo是信号名,func的值是SIG_IGN(表示忽略)、SIG_DFL(系统默认动作)或函数地址。

上面的函数原型比较复杂，可以如下简化：
```C
typedef void Sigfunc(int);
Sigfunc *signal(int , Sigfunc *);
```
而SIG_IGN和SIG_DFL等则声明如下：
```C
#define SIG_ERR (void (*)())-1
#define SIG_DFL (void (*)())0
#define SIG_IGN (void (*)())1
```

**当进程第一次执行时，所有的信号都被设为默认操作，除非父进程忽略它们**

##重入##

当内核发送信号时，进程可能执行到代码的任何位置。例如，进程可能正执行一个重要的操作，如果被中断，进程将会处于不一致的状态。进程甚至可能正在处理另一个信号。

当信号到达时，信号处理程序不能说明进程正在执行什么代码：处理程序可以在任何情况下运行。因此任何该进程设置的信号处理程序都应该谨慎的对待它的操作和它涉及到的数据。

**信号处理程序必须注意，不要对进程被中断时正在作的事情作任何假设，尤其是当修改全局数据时必须要谨慎**

为了使函数可重入，函数绝不能操作静态数据，必须只操作栈分配的数据或者调用者提供的数据，不得调用任何不可重入的函数。


